<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Android UI自动化测试神器-Espresso录制 | Yuanjie-跑步爱好者，IT从业者。</title><meta name=keywords content="Espresso,E2E,Android"><meta name=description content="Espresso Test Recorder的好处

直接录制与APP的所有交互操作
支持在录制过程中添加断言
可直接生成可回放的测试脚本，基本不需要做任何修改

原文地址: Create UI Tests with Espresso Test Recorder，以下为正文


注意: Espresso Test Recorder在AndroidStudio 2.2 Beta版本之后才有。
Espresso Test Recorder可以在不写一行代码的情况下创建UI测试。通过录制一个测试场景，你可以记录设备的交互并在APP的部分快照中添加断言来验证元素。Espresso Test Recorder会保存录制并自动生成对应的UI测试，并可直接运行来测试你的APP。
Espresso Test Recorder编写的测试基于Espresso Testing framework，API在Android Testing Support Library。Espresso API鼓励你创建基于用户操作的简洁且可信赖的UI测试。通过使用expectations、interactions和assertions而不是底层APP的Activity和Views，这样的结构防止了测试的脆弱性并优化测试运行速度。"><meta name=author content="Yuanjie"><link rel=canonical href=https://shiyuanjie.cn/posts/Android/Android-UI%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E7%A5%9E%E5%99%A8-Espresso%E5%BD%95%E5%88%B6/><link crossorigin=anonymous href=/assets/css/stylesheet.a090830a421002426baafbd314e38f149d77b4c48a12ee9312700d770b27fb26.css integrity="sha256-oJCDCkIQAkJrqvvTFOOPFJ13tMSKEu6TEnANdwsn+yY=" rel="preload stylesheet" as=style><link rel=icon href=https://shiyuanjie.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://shiyuanjie.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://shiyuanjie.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://shiyuanjie.cn/apple-touch-icon.png><link rel=mask-icon href=https://shiyuanjie.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://shiyuanjie.cn/posts/Android/Android-UI%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E7%A5%9E%E5%99%A8-Espresso%E5%BD%95%E5%88%B6/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta property="og:url" content="https://shiyuanjie.cn/posts/Android/Android-UI%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E7%A5%9E%E5%99%A8-Espresso%E5%BD%95%E5%88%B6/"><meta property="og:site_name" content="Yuanjie-跑步爱好者，IT从业者。"><meta property="og:title" content="Android UI自动化测试神器-Espresso录制"><meta property="og:description" content="Espresso Test Recorder的好处
直接录制与APP的所有交互操作 支持在录制过程中添加断言 可直接生成可回放的测试脚本，基本不需要做任何修改 原文地址: Create UI Tests with Espresso Test Recorder，以下为正文
注意: Espresso Test Recorder在AndroidStudio 2.2 Beta版本之后才有。
Espresso Test Recorder可以在不写一行代码的情况下创建UI测试。通过录制一个测试场景，你可以记录设备的交互并在APP的部分快照中添加断言来验证元素。Espresso Test Recorder会保存录制并自动生成对应的UI测试，并可直接运行来测试你的APP。
Espresso Test Recorder编写的测试基于Espresso Testing framework，API在Android Testing Support Library。Espresso API鼓励你创建基于用户操作的简洁且可信赖的UI测试。通过使用expectations、interactions和assertions而不是底层APP的Activity和Views，这样的结构防止了测试的脆弱性并优化测试运行速度。"><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-11-25T13:46:00+00:00"><meta property="article:modified_time" content="2016-11-25T13:46:00+00:00"><meta property="article:tag" content="Espresso"><meta property="article:tag" content="E2E"><meta property="article:tag" content="Android"><meta name=twitter:card content="summary"><meta name=twitter:title content="Android UI自动化测试神器-Espresso录制"><meta name=twitter:description content="Espresso Test Recorder的好处

直接录制与APP的所有交互操作
支持在录制过程中添加断言
可直接生成可回放的测试脚本，基本不需要做任何修改

原文地址: Create UI Tests with Espresso Test Recorder，以下为正文


注意: Espresso Test Recorder在AndroidStudio 2.2 Beta版本之后才有。
Espresso Test Recorder可以在不写一行代码的情况下创建UI测试。通过录制一个测试场景，你可以记录设备的交互并在APP的部分快照中添加断言来验证元素。Espresso Test Recorder会保存录制并自动生成对应的UI测试，并可直接运行来测试你的APP。
Espresso Test Recorder编写的测试基于Espresso Testing framework，API在Android Testing Support Library。Espresso API鼓励你创建基于用户操作的简洁且可信赖的UI测试。通过使用expectations、interactions和assertions而不是底层APP的Activity和Views，这样的结构防止了测试的脆弱性并优化测试运行速度。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://shiyuanjie.cn/posts/"},{"@type":"ListItem","position":2,"name":"Android UI自动化测试神器-Espresso录制","item":"https://shiyuanjie.cn/posts/Android/Android-UI%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E7%A5%9E%E5%99%A8-Espresso%E5%BD%95%E5%88%B6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Android UI自动化测试神器-Espresso录制","name":"Android UI自动化测试神器-Espresso录制","description":"Espresso Test Recorder的好处\n直接录制与APP的所有交互操作 支持在录制过程中添加断言 可直接生成可回放的测试脚本，基本不需要做任何修改 原文地址: Create UI Tests with Espresso Test Recorder，以下为正文\n注意: Espresso Test Recorder在AndroidStudio 2.2 Beta版本之后才有。\nEspresso Test Recorder可以在不写一行代码的情况下创建UI测试。通过录制一个测试场景，你可以记录设备的交互并在APP的部分快照中添加断言来验证元素。Espresso Test Recorder会保存录制并自动生成对应的UI测试，并可直接运行来测试你的APP。\nEspresso Test Recorder编写的测试基于Espresso Testing framework，API在Android Testing Support Library。Espresso API鼓励你创建基于用户操作的简洁且可信赖的UI测试。通过使用expectations、interactions和assertions而不是底层APP的Activity和Views，这样的结构防止了测试的脆弱性并优化测试运行速度。\n","keywords":["Espresso","E2E","Android"],"articleBody":"Espresso Test Recorder的好处\n直接录制与APP的所有交互操作 支持在录制过程中添加断言 可直接生成可回放的测试脚本，基本不需要做任何修改 原文地址: Create UI Tests with Espresso Test Recorder，以下为正文\n注意: Espresso Test Recorder在AndroidStudio 2.2 Beta版本之后才有。\nEspresso Test Recorder可以在不写一行代码的情况下创建UI测试。通过录制一个测试场景，你可以记录设备的交互并在APP的部分快照中添加断言来验证元素。Espresso Test Recorder会保存录制并自动生成对应的UI测试，并可直接运行来测试你的APP。\nEspresso Test Recorder编写的测试基于Espresso Testing framework，API在Android Testing Support Library。Espresso API鼓励你创建基于用户操作的简洁且可信赖的UI测试。通过使用expectations、interactions和assertions而不是底层APP的Activity和Views，这样的结构防止了测试的脆弱性并优化测试运行速度。\n查看下面的视频可对Espresso Test Recorder有一个快速的了解，一个新的特性在AndroidStudio2.2:\n关闭你设备中的动画 在使用Espresso Test Recorder之前，确保你关闭你设备中的动画以防止出现非预期的结果。依据\"安装Espresso\"说中在测试UI在单个APP中中，但是记得你不需要手工设置依赖相关配制到Espresso库中，因为Test Recorder会自动帮你做，当你录制的时候。这些步骤只需要在一个已有的项目中做一次。\n录制一个Espresso测试 Espresso测试由两个主要部分组成: 在View元素中的UI交互和断言。UI交互包括一个人可以用来与你APP交互的点击和输入动作。断言验证在屏幕中的可见元素的存在或内容。比如，针对Notes testing app的一个Espresso测试，包括UI交互针对点击一个按钮和写一个新的笔记，但使用断言来验证按钮的存在和笔记内容。\n录制UI交互 为了开始录制一个Espresso Test Recorder，参考下面的步骤\n点击 Run \u003e Record Espresso Test。 在 Select Deployment Target 窗口中，选择你想要录制的测试的设备。如果有必要，创建一个新安卓虚拟设备。点击 OK。 Espresso Test Recorder会激活构建你的项目，APP一定要在Espresso Test Recorder允许你交互之前，安装且启动。在APP启动之后，Record Your Test 窗口会显示，如果你还没有跟设备交互，主面板会显示\"No event recorded yet.\" 与你的设备开始交互来启动记录事件，比如\"点击\"和\"输入\"动作。 注意:在你开始记录交互操作之前，在设备中你也许会看到一个对话框显示\"Waiting for Debugger\"或\"Attaching Debugger\"。Espresso Test Recorder使用debugger来记录UI事件。当debugger被attach，对话框将会自动关闭，不要点击 Force Close.\n录制的交互将会显示在主面板中的 Record Your Test ，像下图1显示。当你开始运行测试，Espresso测试执行这些测试按相同的次序。\n添加断言来验证UI元素 断言通过三种主要的方式验证一个View元素的存在或内容:\ntext is : 校验选择元素的文件内容 exists : 屏幕中当前的View内，校验元素是存在的 does not exist : 当前的View内，校验元素是不存在的 给测试中添加断言，参考下面的步骤:\n点击 Add Assertion 。一个 “屏幕截图\"对话会显示出来，当Espresso获取到关于当前APP状态的UI结构或其它信息。一旦Espresso获取到屏幕截图，对话框将会关闭。 在当前面板 Record Your Test 窗口的右侧会显示当前屏幕显示的布局样式。选择一个需要创建断言的可见元素，在截图中点击元素或点击在窗口底部的 Edit assertion 对话框的第一个下拉菜单。被选择的View对象会在红框中高亮。 在__Edit assertion__ 对话框的第二个下拉菜单中选择你想使用的断言。Espresso交会弹出针对选择元素的断言 如果你选择\"text is\"断言，Espresso会自动插入当前选择元素中的值。你可以在 Edit assertion 编辑文本来匹配你想得到的断言结果。 点击 Save and Add Another 来创建另外一个断言或点击 Save Assertion 来关闭断言面板。 在图2中，显示了\"text is\"断言被创建用于验证笔记的标题是\"Happy Testing!”: 当创建一个断言时，你可以继续与你的APP交互，只要断言面板 Record Your Test 窗口仍然打开。Espresso Test Recorder将持续录制你的动作，一旦你正在编辑的断言保存后，新的交互会显示在后面。针对断方的截屏会保存当你在设备或模拟器中点击\"Add Assertion\"时的APP布局。\n注意：Espresso Test Recorder还是一个实验性的特性，工具当前仅支持可见层断言。你可以通过添加断言来确定屏幕中的元素，屏幕截取仍显示可见模式，并且选择的元素的红色边框和无素在屏幕中的实际位置是不匹配的。\n保存录制 一旦，你完成与你APP的交互并添加了断言，使用下面的步骤来保存你的记录并生成Espresso测试脚本：\n点击 Complete Recording 。Pick a test class name for your test 窗口将会显示。 Espresso Test Recorder将会对测试一个基于启动的Activity的唯一名字。如果你想改变测试名的话，使用 Test class name 。点击 Save 。 如果你没有给项目添加Espresso依赖， Missing Espresso dependencies 对话框会在你保存的时候显示。 点击 Yes 将会自动添加依赖至你的 build.gradle 文件中。\n在Espresso Test Recorder生在文件之后，会自动打开。并且 Android Studio将会在IDE的 Project 窗口中找开测试类。 测试被保存的位置依据你的instrumentation test，也与启动的Activity包名有关。比如，测试Notes testing app保存在 src \u003e androidTest \u003e java \u003e com.example.username.appname 录制测试的APP模块下。\n本地运行Espresso测试 为了运行Espresso测试，使用在IDE左侧的 Project 窗口：\n打开APP模块文件夹，找到你想运行的测试。测试的位置依据你的instrumentation test位置和启动Activity包名。下面的例子说明Notes testing app的测试应该保存在哪： 如果你在窗口中使用Android视图，进入 java \u003e com.example.username.appname(androidTest) . 如果你在窗口中使用 Project视图， 进入 src \u003e androidTest \u003e java \u003e com.example.username.appname 模板文件夹。 在测试代码上点击右键，选择 Run ’testName’ . 同样，你可以打开测试文件，在生成的测试类或方法中右键点击来运行测试。了解更多关于如何运行测试在测试你的APP。 在 Select Deployment Target 窗口，选择你想要运行测试的测试设备。如果有需要，创建一个新安卓虚拟设备。点击 OK 。 在IDE的底部 Run 窗口中，会显示测试的运行过程。Android Studio运行项目的完整构建并在 Run 窗口中打开一个测试名称的页签，如图3展示。你可以在页签中检查是否你的测试通过或失败，以及你的测试运行的多久。当测试结束后，页签将会显示 “Tests ran to completion.” 了解更多的编写测试的运行配制，可以去创建并编辑 运行、调试 配制看\"Defining a test configuration for a class or method\"部分\n运行Android的Espresso测试在 Firebase Test Lab 你可以在Firebase Test Lab运行的Espresso测试在数以百计设备配制中。在Test Lab中可以使用free daily quota on the Spark plan来免费运行测试。为了在Firebase Test Lab中运行测试，为你的APP创建一个Firebase项目，并按Android Studio的操作说明来运行你的测试使用Firebase Test Lab. ","wordCount":"3066","inLanguage":"en","datePublished":"2016-11-25T13:46:00Z","dateModified":"2016-11-25T13:46:00Z","author":{"@type":"Person","name":"Yuanjie"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://shiyuanjie.cn/posts/Android/Android-UI%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E7%A5%9E%E5%99%A8-Espresso%E5%BD%95%E5%88%B6/"},"publisher":{"@type":"Organization","name":"Yuanjie-跑步爱好者，IT从业者。","logo":{"@type":"ImageObject","url":"https://shiyuanjie.cn/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://shiyuanjie.cn/ accesskey=h title="Yuanjie-跑步爱好者，IT从业者。 (Alt + H)">Yuanjie-跑步爱好者，IT从业者。</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://shiyuanjie.cn/tools/ title=小工具><span>小工具</span></a></li><li><a href=https://shiyuanjie.cn/archives/ title=归档><span>归档</span></a></li><li><a href=https://shiyuanjie.cn/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://shiyuanjie.cn/>Home</a>&nbsp;»&nbsp;<a href=https://shiyuanjie.cn/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Android UI自动化测试神器-Espresso录制</h1><div class=post-meta><span title='2016-11-25 13:46:00 +0000 UTC'>November 25, 2016</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>Yuanjie</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%85%b3%e9%97%ad%e4%bd%a0%e8%ae%be%e5%a4%87%e4%b8%ad%e7%9a%84%e5%8a%a8%e7%94%bb aria-label=关闭你设备中的动画>关闭你设备中的动画</a></li><li><a href=#%e5%bd%95%e5%88%b6%e4%b8%80%e4%b8%aaespresso%e6%b5%8b%e8%af%95 aria-label=录制一个Espresso测试>录制一个Espresso测试</a></li><li><a href=#%e5%bd%95%e5%88%b6ui%e4%ba%a4%e4%ba%92 aria-label=录制UI交互>录制UI交互</a></li><li><a href=#%e6%b7%bb%e5%8a%a0%e6%96%ad%e8%a8%80%e6%9d%a5%e9%aa%8c%e8%af%81ui%e5%85%83%e7%b4%a0 aria-label=添加断言来验证UI元素>添加断言来验证UI元素</a></li><li><a href=#%e4%bf%9d%e5%ad%98%e5%bd%95%e5%88%b6 aria-label=保存录制>保存录制</a></li><li><a href=#%e6%9c%ac%e5%9c%b0%e8%bf%90%e8%a1%8cespresso%e6%b5%8b%e8%af%95 aria-label=本地运行Espresso测试>本地运行Espresso测试</a></li><li><a href=#%e8%bf%90%e8%a1%8candroid%e7%9a%84espresso%e6%b5%8b%e8%af%95%e5%9c%a8-firebase-test-lab aria-label="运行Android的Espresso测试在 Firebase Test Lab">运行Android的Espresso测试在 Firebase Test Lab</a></li></ul></div></details></div><div class=post-content><p>Espresso Test Recorder的好处</p><ul><li>直接录制与APP的所有交互操作</li><li>支持在录制过程中添加断言</li><li>可直接生成<code>可回放</code>的测试脚本，基本不需要做任何修改</li></ul><p>原文地址: <a href=https://developer.android.com/studio/test/espresso-test-recorder.html>Create UI Tests with Espresso Test Recorder</a>，以下为正文</p><hr><blockquote><p>注意: Espresso Test Recorder在AndroidStudio 2.2 Beta版本之后才有。</p></blockquote><p>Espresso Test Recorder可以在不写一行代码的情况下创建UI测试。通过录制一个测试场景，你可以记录设备的交互并在APP的部分快照中添加断言来验证元素。Espresso Test Recorder会保存录制并自动生成对应的UI测试，并可直接运行来测试你的APP。</p><p>Espresso Test Recorder编写的测试基于<a href=https://google.github.io/android-testing-support-library/docs/espresso/>Espresso Testing framework</a>，API在<a href=https://developer.android.com/topic/libraries/testing-support-library/index.html>Android Testing Support Library</a>。Espresso API鼓励你创建基于用户操作的简洁且可信赖的UI测试。通过使用expectations、interactions和assertions而不是底层APP的Activity和Views，这样的结构防止了测试的脆弱性并优化测试运行速度。</p><p>查看下面的视频可对Espresso Test Recorder有一个快速的了解，一个新的特性在AndroidStudio2.2:</p><iframe height=498 width=510 src=https://storage.googleapis.com/androiddevelopers/videos/studio/espresso-test-recorder-overview_v2.mp4 frameborder=0 allowfullscreen></iframe><h2 id=关闭你设备中的动画>关闭你设备中的动画<a hidden class=anchor aria-hidden=true href=#关闭你设备中的动画>#</a></h2><p>在使用Espresso Test Recorder之前，确保你关闭你设备中的动画以防止出现非预期的结果。依据"安装Espresso"说中在<a href=https://developer.android.com/training/testing/ui-testing/espresso-testing.html#setup>测试UI在单个APP中</a>中，但是记得你不需要手工设置依赖相关配制到Espresso库中，因为Test Recorder会自动帮你做，当你录制的时候。这些步骤只需要在一个已有的项目中做一次。</p><h2 id=录制一个espresso测试>录制一个Espresso测试<a hidden class=anchor aria-hidden=true href=#录制一个espresso测试>#</a></h2><p>Espresso测试由两个主要部分组成: 在View元素中的UI交互和断言。UI交互包括一个人可以用来与你APP交互的点击和输入动作。断言验证在屏幕中的可见元素的存在或内容。比如，针对<a href=https://github.com/googlecodelabs/android-testing>Notes testing app</a>的一个Espresso测试，包括UI交互针对点击一个按钮和写一个新的笔记，但使用断言来验证按钮的存在和笔记内容。</p><h2 id=录制ui交互>录制UI交互<a hidden class=anchor aria-hidden=true href=#录制ui交互>#</a></h2><p>为了开始录制一个Espresso Test Recorder，参考下面的步骤</p><ol><li>点击 <strong>Run > Record Espresso Test</strong>。</li><li>在 <strong>Select Deployment Target</strong> 窗口中，选择你想要录制的测试的设备。如果有必要，<a href=https://developer.android.com/studio/run/managing-avds.html>创建一个新安卓虚拟设备</a>。点击 <strong>OK</strong>。</li><li>Espresso Test Recorder会激活构建你的项目，APP一定要在Espresso Test Recorder允许你交互之前，安装且启动。在APP启动之后，<strong>Record Your Test</strong> 窗口会显示，如果你还没有跟设备交互，主面板会显示"No event recorded yet." 与你的设备开始交互来启动记录事件，比如"点击"和"输入"动作。</li></ol><blockquote><p>注意:在你开始记录交互操作之前，在设备中你也许会看到一个对话框显示"Waiting for Debugger"或"Attaching Debugger"。Espresso Test Recorder使用debugger来记录UI事件。当debugger被attach，对话框将会自动关闭，不要点击 <strong>Force Close</strong>.</p></blockquote><p>录制的交互将会显示在主面板中的 <strong>Record Your Test</strong> ，像下图1显示。当你开始运行测试，Espresso测试执行这些测试按相同的次序。</p><p><img alt=图1 loading=lazy src=https://developer.android.com/studio/images/test/espresso-test-recorder-window_2-2_2x.png></p><h2 id=添加断言来验证ui元素>添加断言来验证UI元素<a hidden class=anchor aria-hidden=true href=#添加断言来验证ui元素>#</a></h2><p>断言通过三种主要的方式验证一个<a href=https://developer.android.com/reference/android/view/View.html>View</a>元素的存在或内容:</p><ul><li><strong>text is</strong> : 校验选择元素的文件内容</li><li><strong>exists</strong> : 屏幕中当前的View内，校验元素是存在的</li><li><strong>does not exist</strong> : 当前的View内，校验元素是不存在的</li></ul><p>给测试中添加断言，参考下面的步骤:</p><ol><li>点击 <strong>Add Assertion</strong> 。一个 &ldquo;屏幕截图"对话会显示出来，当Espresso获取到关于当前APP状态的UI结构或其它信息。一旦Espresso获取到屏幕截图，对话框将会关闭。</li><li>在当前面板 <strong>Record Your Test</strong> 窗口的右侧会显示当前屏幕显示的布局样式。选择一个需要创建断言的可见元素，在截图中点击元素或点击在窗口底部的 <strong>Edit assertion</strong> 对话框的第一个下拉菜单。被选择的View对象会在红框中高亮。</li><li>在__Edit assertion__ 对话框的第二个下拉菜单中选择你想使用的断言。Espresso交会弹出针对选择元素的断言</li></ol><ul><li>如果你选择"text is"断言，Espresso会自动插入当前选择元素中的值。你可以在 <strong>Edit assertion</strong> 编辑文本来匹配你想得到的断言结果。</li></ul><ol start=4><li>点击 <strong>Save and Add Another</strong> 来创建另外一个断言或点击 <strong>Save Assertion</strong> 来关闭断言面板。</li></ol><p>在图2中，显示了"text is"断言被创建用于验证笔记的标题是"Happy Testing!&rdquo;:
<img alt=图2 loading=lazy src=https://developer.android.com/studio/images/test/espresso-test-recorder-assertion_2-2_2x.png></p><p>当创建一个断言时，你可以继续与你的APP交互，只要断言面板 <strong>Record Your Test</strong> 窗口仍然打开。Espresso Test Recorder将持续录制你的动作，一旦你正在编辑的断言保存后，新的交互会显示在后面。针对断方的截屏会保存当你在设备或模拟器中点击"Add Assertion"时的APP布局。</p><blockquote><p>注意：Espresso Test Recorder还是一个实验性的特性，工具当前仅支持可见层断言。你可以通过添加断言来确定屏幕中的元素，屏幕截取仍显示可见模式，并且选择的元素的红色边框和无素在屏幕中的实际位置是不匹配的。</p></blockquote><h2 id=保存录制>保存录制<a hidden class=anchor aria-hidden=true href=#保存录制>#</a></h2><p>一旦，你完成与你APP的交互并添加了断言，使用下面的步骤来保存你的记录并生成Espresso测试脚本：</p><ol><li>点击 <strong>Complete Recording</strong> 。<strong>Pick a test class name for your test</strong> 窗口将会显示。</li><li>Espresso Test Recorder将会对测试一个基于启动的Activity的唯一名字。如果你想改变测试名的话，使用 <strong>Test class name</strong> 。点击 <strong>Save</strong> 。</li></ol><blockquote><p>如果你没有给项目添加Espresso依赖， <strong>Missing Espresso dependencies</strong> 对话框会在你保存的时候显示。 点击 <strong>Yes</strong> 将会自动添加依赖至你的 build.gradle 文件中。</p></blockquote><ol start=3><li>在Espresso Test Recorder生在文件之后，会自动打开。并且 Android Studio将会在IDE的 <strong>Project</strong> 窗口中找开测试类。</li></ol><blockquote><p>测试被保存的位置依据你的<a href=https://developer.android.com/training/testing/unit-testing/instrumented-unit-tests.html>instrumentation test</a>，也与启动的Activity包名有关。比如，测试<a href=https://github.com/googlecodelabs/android-testing>Notes testing app</a>保存在 <strong>src > androidTest > java > com.example.username.appname</strong> 录制测试的APP模块下。</p></blockquote><h2 id=本地运行espresso测试>本地运行Espresso测试<a hidden class=anchor aria-hidden=true href=#本地运行espresso测试>#</a></h2><p>为了运行Espresso测试，使用在IDE左侧的 <strong>Project</strong> 窗口：</p><ol><li>打开APP模块文件夹，找到你想运行的测试。测试的位置依据你的<a href=https://developer.android.com/training/testing/unit-testing/instrumented-unit-tests.html>instrumentation test</a>位置和启动Activity包名。下面的例子说明<a href=https://github.com/googlecodelabs/android-testing>Notes testing app</a>的测试应该保存在哪：</li></ol><ul><li>如果你在窗口中使用<a href=https://developer.android.com/studio/projects/index.html#ProjectFiles>Android视图</a>，进入 <strong>java > com.example.username.appname(androidTest)</strong> .</li><li>如果你在窗口中使用 <strong>Project视图</strong>， 进入 <strong>src > androidTest > java > com.example.username.appname</strong> 模板文件夹。</li></ul><ol start=2><li>在测试代码上点击右键，选择 <strong>Run &rsquo;testName&rsquo;</strong> .</li></ol><ul><li>同样，你可以打开测试文件，在生成的测试类或方法中右键点击来运行测试。了解更多关于如何运行测试在<a href=https://developer.android.com/studio/test/index.html#run_a_test>测试你的APP</a>。</li></ul><ol start=3><li>在 <strong>Select Deployment Target</strong> 窗口，选择你想要运行测试的测试设备。如果有需要，<a href=https://developer.android.com/studio/run/managing-avds.html>创建一个新安卓虚拟设备</a>。点击 <strong>OK</strong> 。</li></ol><p>在IDE的底部 <strong>Run</strong> 窗口中，会显示测试的运行过程。Android Studio运行项目的完整构建并在 <strong>Run</strong> 窗口中打开一个测试名称的页签，如图3展示。你可以在页签中检查是否你的测试通过或失败，以及你的测试运行的多久。当测试结束后，页签将会显示 &ldquo;Tests ran to completion.&rdquo;
<img alt=图3 loading=lazy src=https://developer.android.com/studio/images/test/run-window-espresso-test_2-2-preview-7_2x.png></p><p>了解更多的编写测试的运行配制，可以去<a href=https://developer.android.com/studio/run/rundebugconfig.html#creating>创建并编辑 运行、调试 配制</a>看"Defining a test configuration for a class or method"部分</p><h2 id=运行android的espresso测试在-firebase-test-lab>运行Android的Espresso测试在 Firebase Test Lab<a hidden class=anchor aria-hidden=true href=#运行android的espresso测试在-firebase-test-lab>#</a></h2><p>你可以在<a href=https://firebase.google.com/docs/test-lab/>Firebase Test Lab</a>运行的Espresso测试在数以百计设备配制中。在Test Lab中可以使用<a href=https://firebase.google.com/docs/test-lab/overview#quota_for_spark_and_flame_plans>free daily quota on the Spark plan</a>来免费运行测试。为了在<a href=https://firebase.google.com/docs/test-lab/>Firebase Test Lab</a>中运行测试，为你的APP<a href=https://firebase.google.com/docs/test-lab/web-ui#create_a_firebase_project>创建一个Firebase项目</a>，并按Android Studio的操作说明来<a href=https://developer.android.com/training/testing/unit-testing/instrumented-unit-tests.html#run-ctl>运行你的测试使用Firebase Test Lab</a>.
<img alt="图4 在Run窗口的使用Firebase Test Lab测试多个设备的结果展示" loading=lazy src=https://developer.android.com/images/training/ctl-test-results.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://shiyuanjie.cn/tags/Espresso/>Espresso</a></li><li><a href=https://shiyuanjie.cn/tags/E2E/>E2E</a></li><li><a href=https://shiyuanjie.cn/tags/Android/>Android</a></li></ul><nav class=paginav><a class=prev href=https://shiyuanjie.cn/posts/UITest/Layout%E6%B5%8B%E8%AF%95/><span class=title>« Prev</span><br><span>Layout测试</span>
</a><a class=next href=https://shiyuanjie.cn/posts/UITest/PageObject%E5%88%86%E7%A6%BBE2E%E6%B5%8B%E8%AF%95/><span class=title>Next »</span><br><span>PageObject分离E2E测试</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Android UI自动化测试神器-Espresso录制 on x" href="https://x.com/intent/tweet/?text=Android%20UI%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e7%a5%9e%e5%99%a8-Espresso%e5%bd%95%e5%88%b6&amp;url=https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f&amp;hashtags=Espresso%2cE2E%2cAndroid"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Android UI自动化测试神器-Espresso录制 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f&amp;title=Android%20UI%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e7%a5%9e%e5%99%a8-Espresso%e5%bd%95%e5%88%b6&amp;summary=Android%20UI%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e7%a5%9e%e5%99%a8-Espresso%e5%bd%95%e5%88%b6&amp;source=https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Android UI自动化测试神器-Espresso录制 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f&title=Android%20UI%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e7%a5%9e%e5%99%a8-Espresso%e5%bd%95%e5%88%b6"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Android UI自动化测试神器-Espresso录制 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Android UI自动化测试神器-Espresso录制 on whatsapp" href="https://api.whatsapp.com/send?text=Android%20UI%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e7%a5%9e%e5%99%a8-Espresso%e5%bd%95%e5%88%b6%20-%20https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Android UI自动化测试神器-Espresso录制 on telegram" href="https://telegram.me/share/url?text=Android%20UI%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e7%a5%9e%e5%99%a8-Espresso%e5%bd%95%e5%88%b6&amp;url=https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Android UI自动化测试神器-Espresso录制 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Android%20UI%e8%87%aa%e5%8a%a8%e5%8c%96%e6%b5%8b%e8%af%95%e7%a5%9e%e5%99%a8-Espresso%e5%bd%95%e5%88%b6&u=https%3a%2f%2fshiyuanjie.cn%2fposts%2fAndroid%2fAndroid-UI%25E8%2587%25AA%25E5%258A%25A8%25E5%258C%2596%25E6%25B5%258B%25E8%25AF%2595%25E7%25A5%259E%25E5%2599%25A8-Espresso%25E5%25BD%2595%25E5%2588%25B6%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main></body></html>